@model Zira.Services.Analytics.Models.ExpenseComparisonModel

@{
    Layout = "Shared/_AnalyticsLayout";
    ViewData["Title"] = @AnalyticsText.FinancialOverview;
}

<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4 d-flex align-items-center gap-2">Expense Comparison</h4>

    <div class="card shadow-lg border-0 mb-4">
        <div class="card-header bg-white py-3 px-4">
            <h4 class="mb-0">Monthly Comparison</h4>
        </div>
        <div class="card-body p-4">
            <table class="table table-responsive">
                <thead>
                <tr>
                    <th class="fw-medium">Month</th>
                    <th class="fw-medium">Income</th>
                    <th class="fw-medium">Expenses</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var item in Model.MonthlyComparison)
                {
                    <tr>
                        <td class="text-nowrap">@item.Month</td>
                        <td class="text-nowrap">@item.Income.ToString("C")</td>
                        <td class="text-nowrap">@item.Expenses.ToString("C")</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>

    <div class="card shadow-lg border-0">
        <div class="card-header bg-white py-3 px-4">
            <h4 class="mb-0">Category-Based Spending</h4>
        </div>
        <div class="card-body p-4">
            <div id="categoryChart"></div>
        </div>
    </div>


    <div class="card shadow-lg border-0 mt-4">
        <div class="card-header bg-white py-3 px-4">
            <h4 class="mb-0">Monthly Savings Rate</h4>
        </div>
        <div class="card-body p-4">
            <table class="table">
                <thead>
                <tr>
                    <th>Month</th>
                    <th>Savings Rate (%)</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var item in Model.MonthlySavingsRate)
                {
                    <tr>
                        <td>@item.Month</td>
                        <td>@item.SavingsRate.ToString("0.##")%</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var categoryChartOptions = {
            chart: {
                type: "donut",
                height: 400
            },
            labels: @Json.Serialize(Model.CategoryComparison.Select(x => x.Category)),
            series: @Json.Serialize(Model.CategoryComparison.Select(x => x.TotalAmount)),
            colors: [
                "#ff6384", "#36a2eb", "#ffce56", "#4bc0c0",
                "#9966ff", "#ff9f40", "#ff6384", "#1abc9c",
                "#f39c12", "#7f8c8d"
            ],
            legend: {
                position: "bottom"
            },
            dataLabels: {
                enabled: true,
                formatter: function (val) {
                    return parseInt(val) + "%";
                }
            },
            tooltip: {
                y: {
                    formatter: function(value) {
                        return "$" + value.toLocaleString();
                    }
                }
            }
        };

        var categoryChart = new ApexCharts(document.querySelector("#categoryChart"), categoryChartOptions);
        categoryChart.render();

    });
</script>